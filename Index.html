<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ±Ø§ÙØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Earthy & Calm (Warm neutrals, soft greens, muted blues/grays) -->
    <!-- Application Structure Plan: A single-page application built around a tabbed navigation for financial operations. Each tab represents a distinct functional area of the accounting system (Dashboard, Transfers, Receipts, Payments, Exchange, Reports, Settings). This structure provides clear segregation of duties, allowing users to focus on one task at a time, while easily navigating between different financial operations. The core interaction within each tab is form submission and table display. The 'Transfers' tab features an interactive WhatsApp message parsing and form pre-filling. A new dashboard section provides a quick financial overview. User feedback is enhanced with custom modals replacing native alerts and inline form validation. Tables and print functionality are further refined for better aesthetics and usability. -->
    <!-- Visualization & Content Choices: Data input is via interactive forms, and records are displayed in dynamic, responsive HTML tables with improved styling. The primary interactive elements include tab switching, form input/submission, record deletion, and the WhatsApp message parsing/pre-filling. The "Dashboard" section shows aggregated financial summaries as formatted text. Print functionality now includes a professional report header and print-specific CSS. No Chart.js or Plotly.js are used as the core data is transactional and process-driven, not requiring complex analytical visualizations. Unicode characters/icons are used for visual cues. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background-color: #fcf8f3; /* Light, warm background */
            color: #3f3f46; /* Neutral dark text */
        }
        .tab-button.active {
            @apply border-b-2 border-emerald-600 text-emerald-700 font-semibold bg-white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-input-field {
            @apply w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-300;
            background-color: #fefcfb; /* Slightly off-white for inputs */
        }
        .action-button {
            @apply bg-red-500 text-white p-2 rounded-md hover:bg-red-600 transition-colors text-sm;
        }
        .whatsapp-parse-button {
            @apply bg-green-500 text-white py-2 px-4 rounded-lg flex items-center justify-center gap-2 hover:bg-green-600 transition-colors font-medium shadow-md;
        }
        .primary-button {
            @apply bg-teal-600 text-white py-2 px-6 rounded-lg hover:bg-teal-700 transition-colors font-semibold shadow-md;
        }
        .secondary-button {
            @apply bg-gray-300 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-400 transition-colors font-semibold shadow-md;
        }
        /* Table Styling */
        .data-table-container {
            @apply overflow-x-auto rounded-lg border border-gray-200 shadow-sm;
        }
        .data-table {
            @apply min-w-full bg-white text-gray-700;
            border-collapse: separate; /* Required for rounded corners on cells */
            border-spacing: 0; /* Remove default spacing */
        }
        .data-table thead th {
            @apply bg-gradient-to-r from-stone-200 to-stone-100 text-stone-700 uppercase text-sm py-3 px-4 text-right font-semibold;
            border-bottom: 2px solid #d4c8be; /* Stronger bottom border for header */
            border-top-left-radius: 8px; /* For first header cell */
            border-top-right-radius: 8px; /* For last header cell */
            /* This needs adjustment for RTL: first cell is top-right, last is top-left */
        }
        .data-table thead th:first-child { border-top-right-radius: 8px; }
        .data-table thead th:last-child { border-top-left-radius: 8px; }

        .data-table tbody tr {
            @apply border-b border-gray-100; /* Lighter border for rows */
        }
        .data-table tbody tr:nth-child(even) { /* Zebra striping */
            background-color: #fdfaf6;
        }
        .data-table tbody tr:hover {
            @apply bg-gray-50;
        }
        .data-table tbody td {
            @apply py-2 px-4 text-gray-700 text-right; /* Align text right */
            border-right: 1px solid #e5e7eb; /* Right border for cells */
            border-left: 1px solid #e5e7eb; /* Left border for cells */
            border-bottom: 1px solid #e5e7eb; /* Bottom border for cells */
        }
        .data-table tbody tr:last-child td {
            border-bottom: none; /* No bottom border for last row cells */
        }
        .data-table tbody tr:last-child td:first-child { border-bottom-right-radius: 8px; }
        .data-table tbody tr:last-child td:last-child { border-bottom-left-radius: 8px; }

        .error-message {
            @apply text-red-500 text-xs mt-1;
        }
        /* Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .modal-button {
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .modal-confirm {
            background-color: #10B981; /* Green */
            color: white;
            border: none;
        }
        .modal-confirm:hover {
            background-color: #059669;
        }
        .modal-cancel {
            background-color: #D1D5DB; /* Gray */
            color: #3f3f46;
            border: none;
        }
        .modal-cancel:hover {
            background-color: #9CA3AF;
        }
        /* Mobile table styles */
        @media (max-width: 768px) {
            table.responsive-table {
                @apply block w-full;
            }
            table.responsive-table thead {
                @apply hidden;
            }
            table.responsive-table tbody, table.responsive-table tr, table.responsive-table td {
                @apply block w-full;
            }
            table.responsive-table tr {
                @apply mb-4 border border-gray-200 rounded-lg shadow-sm;
            }
            table.responsive-table td {
                @apply text-right relative pl-32;
            }
            table.responsive-table td::before {
                @apply absolute left-4 w-28 text-left font-medium text-gray-600;
                content: attr(data-label);
            }
        }

        /* Print-specific styles (will be injected) */
        @media print {
            body {
                background-color: white;
                margin: 0;
                padding: 0;
                font-size: 10pt;
                color: #000;
            }
            h1, h2, h3, p {
                color: #000 !important;
            }
            .no-print {
                display: none !important;
            }
            .data-table-container {
                overflow-x: visible; /* Allow tables to show full width */
                box-shadow: none;
                border: none;
                border-radius: 0;
            }
            .data-table {
                width: 100%;
                table-layout: auto; /* Allow content to dictate column width */
                border-collapse: collapse; /* For print, collapse borders */
                border-spacing: 0;
            }
            .data-table thead th, .data-table tbody td {
                border: 1px solid #ccc; /* Clearer borders for print */
                padding: 5px 8px;
                text-align: right;
                background-color: white !important; /* Ensure white background for print */
                color: black !important; /* Ensure black text for print */
                border-radius: 0 !important; /* Remove rounded corners for print */
            }
            .data-table thead th {
                background-color: #e0e0e0 !important;
                font-weight: bold;
            }
            .data-table tbody tr:nth-child(even) {
                background-color: #f5f5f5 !important;
            }
            /* Override mobile table styles for print */
            table.responsive-table, table.responsive-table thead, table.responsive-table tbody, table.responsive-table tr, table.responsive-table td {
                display: table;
                width: 100%;
            }
            table.responsive-table thead {
                display: table-header-group;
            }
            table.responsive-table tr {
                display: table-row;
                margin-bottom: 0;
                border: 1px solid #ccc; /* Ensure border for print */
            }
            table.responsive-table td {
                display: table-cell;
                position: static;
                padding-left: 8px; /* Reset padding */
                text-align: right;
            }
            table.responsive-table td::before {
                display: none; /* Hide data labels for print */
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
        <header class="bg-gradient-to-r from-teal-700 to-emerald-600 p-6 text-white text-center no-print">
            <h1 class="text-3xl sm:text-4xl font-extrabold mb-2">Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ±Ø§ÙØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</h1>
            <p class="text-sm sm:text-base opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§ØªÙƒ Ø§Ù„Ù…Ø§Ù„ÙŠØ©.</p>
        </header>

        <div class="p-4 sm:p-6">
            <!-- Navigation Tabs -->
            <nav class="flex flex-wrap border-b border-gray-200 mb-6 no-print">
                <button class="tab-button tab-button-dashboard flex-1 py-3 px-2 text-sm sm:text-base text-gray-600 hover:text-emerald-700 transition-colors duration-200 active" data-tab="dashboard">ğŸ“ˆ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
                <button class="tab-button tab-button-transfers flex-1 py-3 px-2 text-sm sm:text-base text-gray-600 hover:text-emerald-700 transition-colors duration-200" data-tab="transfers">ğŸ§¾ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</button>
                <button class="tab-button tab-button-receipts flex-1 py-3 px-2 text-sm sm:text-base text-gray-600 hover:text-emerald-700 transition-colors duration-200" data-tab="receipts">ğŸ’° Ø³Ù†Ø¯Ø§Øª Ø§Ù„Ù‚Ø¨Ø¶</button>
                <button class="tab-button tab-button-payments flex-1 py-3 px-2 text-sm sm:text-base text-gray-600 hover:text-emerald-700 transition-colors duration-200" data-tab="payments">ğŸ’¸ Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØµØ±Ù</button>
                <button class="tab-button tab-button-exchange flex-1 py-3 px-2 text-sm sm:text-base text-gray-600 hover:text-emerald-700 transition-colors duration-200" data-tab="exchange">ğŸ’± Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</button>
                <button class="tab-button tab-button-reports flex-1 py-3 px-2 text-sm sm:text-base text-gray-600 hover:text-emerald-700 transition-colors duration-200" data-tab="reports">ğŸ“Š ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                <button class="tab-button tab-button-settings flex-1 py-3 px-2 text-sm sm:text-base text-gray-600 hover:text-emerald-700 transition-colors duration-200" data-tab="settings">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </nav>

            <!-- Tab Contents -->
            <div id="tab-contents" class="p-2 sm:p-4 bg-gray-50 rounded-lg border border-gray-100 shadow-inner">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“ˆ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
                    <p class="text-gray-600 mb-6">Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø³Ø±ÙŠØ¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© ÙÙŠ Ù†Ø¸Ø§Ù…Ùƒ. ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø±ØµØ¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø³Ø¬Ù„Ø©.</p>
                    
                    <div id="currencyBalances" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Balances will be rendered here by JS -->
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 text-center">
                            <p class="text-xl font-bold text-gray-800">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 mt-6">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø±ØµØ¯Ø© ØªØ¹ÙƒØ³ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© ÙÙŠ ÙƒÙ„ Ø¹Ù…Ù„Ø© (Ø³Ù†Ø¯Ø§Øª Ø§Ù„Ù‚Ø¨Ø¶ ÙˆØ§Ù„ØµØ±ÙØŒ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§ØªØŒ ÙˆØ¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµØ±Ø§ÙØ©). Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø³Ù… "ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨".</p>
                </div>

                <!-- Transfers Tab -->
                <div id="transfers" class="tab-content">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ§¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</h2>
                    <p class="text-gray-600 mb-6">Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ø®ØµØµ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ØµØ§Ø¯Ø±Ø© ÙˆØ§Ù„ÙˆØ§Ø±Ø¯Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹ØŒ Ø£Ùˆ **Ù„ØµÙ‚ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙ…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù„ÙŠÙ„Ù‡Ø§** Ù„Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„ØªØ¨Ø³ÙŠØ·.</p>
                    
                    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <label for="whatsappMessageInput" class="block text-sm font-medium text-blue-800 mb-2">Ø§Ù„ØµÙ‚ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù‡Ù†Ø§ Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø©:</label>
                        <textarea id="whatsappMessageInput" rows="4" class="form-input-field mb-4 bg-white text-gray-800" placeholder="Ù…Ø«Ø§Ù„: 'Ø­ÙˆØ§Ù„Ø© ÙˆØ§Ø±Ø¯Ø©: 2500 Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ Ù…Ù† ÙÙ‡Ø¯ Ø§Ù„Ø¹Ù„ÙŠ Ø¥Ù„Ù‰ Ø®Ø§Ù„Ø¯ Ø§Ù„Ø±Ø´ÙŠØ¯.'"></textarea>
                        <button id="parseWhatsappBtn" class="whatsapp-parse-button">
                            <span>&#128172;</span> ØªØ­Ù„ÙŠÙ„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙ…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                        </button>
                        <p id="parseFeedback" class="mt-2 text-sm text-gray-700"></p>
                    </div>

                    <form id="formTransfers" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="col-span-full">
                            <label for="transferType" class="block text-sm font-medium text-gray-700 mb-1">Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
                            <select id="transferType" class="form-input-field" required>
                                <option value="ØµØ§Ø¯Ø±">ØµØ§Ø¯Ø±</option>
                                <option value="ÙˆØ§Ø±Ø¯">ÙˆØ§Ø±Ø¯</option>
                            </select>
                            <p class="error-message" id="transferType-error"></p>
                        </div>

                        <div>
                            <label for="transferAmount" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input type="number" id="transferAmount" min="0.01" step="0.01" class="form-input-field" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" />
                            <p class="error-message" id="transferAmount-error"></p>
                        </div>
                        <div>
                            <label for="transferCurrency" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                            <select id="transferCurrency" class="form-input-field" required>
                                <option value="">Ø§Ø®ØªØ± Ø¹Ù…Ù„Ø©</option>
                                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                                <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                                <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                <option value="EGP">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ (EGP)</option>
                                <option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ (YER)</option>
                            </select>
                            <p class="error-message" id="transferCurrency-error"></p>
                        </div>
                        <div class="col-span-full sm:col-span-1">
                            <label for="transferDate" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="transferDate" class="form-input-field" required />
                            <p class="error-message" id="transferDate-error"></p>
                        </div>

                        <div>
                            <label for="transferSender" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„</label>
                            <input type="text" id="transferSender" class="form-input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„" required />
                            <p class="error-message" id="transferSender-error"></p>
                        </div>
                        <div>
                            <label for="transferSenderEntity" class="block text-sm font-medium text-gray-700 mb-1">Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„</label>
                            <input type="text" id="transferSenderEntity" class="form-input-field" placeholder="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„" required />
                            <p class="error-message" id="transferSenderEntity-error"></p>
                        </div>
                        <div>
                            <label for="transferReceiver" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                            <input type="text" id="transferReceiver" class="form-input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…" required />
                            <p class="error-message" id="transferReceiver-error"></p>
                        </div>
                        <div>
                            <label for="transferReceiverEntity" class="block text-sm font-medium text-gray-700 mb-1">Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                            <input type="text" id="transferReceiverEntity" class="form-input-field" placeholder="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…" required />
                            <p class="error-message" id="transferReceiverEntity-error"></p>
                        </div>
                        
                        <div class="col-span-full flex justify-end mt-4">
                            <button type="submit" class="primary-button">Ø­ÙØ¸ Ø§Ù„ØªØ­ÙˆÙŠÙ„</button>
                        </div>
                    </form>

                    <h3 class="text-xl font-semibold text-gray-800 mt-8 mb-4">Ø³Ø¬Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</h3>
                    <div class="data-table-container">
                        <table id="tableTransfers" class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù…</th>
                                    <th>Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„</th>
                                    <th>Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                                    <th>Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                                    <th>Ø­Ø°Ù</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="flex justify-end mt-4 no-print">
                        <button class="secondary-button print-btn" onclick="printTable('tableTransfers', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª')">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</button>
                    </div>
                </div>

                <!-- Receipts Tab -->
                <div id="receipts" class="tab-content">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ’° Ø³Ù†Ø¯Ø§Øª Ø§Ù„Ù‚Ø¨Ø¶</h2>
                    <p class="text-gray-600 mb-6">Ø³Ø¬Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø£Ùˆ Ø§Ù„Ø´ÙŠÙƒØ§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù…Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰. Ù‡Ø°Ø§ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø¨Ø¯Ù‚Ø©.</p>
                    <form id="formReceipts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label for="receiptAmount" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input type="number" id="receiptAmount" min="0.01" step="0.01" class="form-input-field" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" />
                            <p class="error-message" id="receiptAmount-error"></p>
                        </div>
                        <div>
                            <label for="receiptCurrency" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                            <select id="receiptCurrency" class="form-input-field" required>
                                <option value="">Ø§Ø®ØªØ± Ø¹Ù…Ù„Ø©</option>
                                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                                <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                                <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                <option value="EGP">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ (EGP)</option>
                                <option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ (YER)</option>
                            </select>
                            <p class="error-message" id="receiptCurrency-error"></p>
                        </div>
                        <div class="col-span-full sm:col-span-1">
                            <label for="receiptDate" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="receiptDate" class="form-input-field" required />
                            <p class="error-message" id="receiptDate-error"></p>
                        </div>

                        <div>
                            <label for="receiptSender" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„</label>
                            <input type="text" id="receiptSender" class="form-input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„" required />
                            <p class="error-message" id="receiptSender-error"></p>
                        </div>
                        <div>
                            <label for="receiptSenderEntity" class="block text-sm font-medium text-gray-700 mb-1">Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„</label>
                            <input type="text" id="receiptSenderEntity" class="form-input-field" placeholder="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„" required />
                            <p class="error-message" id="receiptSenderEntity-error"></p>
                        </div>
                        <div>
                            <label for="receiptReceiver" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ù„Ø¹Ù…ÙŠÙ„)</label>
                            <input type="text" id="receiptReceiver" class="form-input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…" required />
                            <p class="error-message" id="receiptReceiver-error"></p>
                        </div>
                        <div>
                            <label for="receiptReceiverEntity" class="block text-sm font-medium text-gray-700 mb-1">Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                            <input type="text" id="receiptReceiverEntity" class="form-input-field" placeholder="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…" required />
                            <p class="error-message" id="receiptReceiverEntity-error"></p>
                        </div>
                        <div class="col-span-full">
                            <label for="receiptNotes" class="block text-sm font-medium text-gray-700 mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <textarea id="receiptNotes" rows="3" class="form-input-field"></textarea>
                        </div>

                        <div class="col-span-full flex justify-end mt-4">
                            <button type="submit" class="primary-button">Ø­ÙØ¸ Ø§Ù„Ø³Ù†Ø¯</button>
                        </div>
                    </form>

                    <h3 class="text-xl font-semibold text-gray-800 mt-8 mb-4">Ø³Ø¬Ù„ Ø³Ù†Ø¯Ø§Øª Ø§Ù„Ù‚Ø¨Ø¶</h3>
                    <div class="data-table-container">
                        <table id="tableReceipts" class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù…</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„</th>
                                    <th>Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                                    <th>Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                                    <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                    <th>Ø­Ø°Ù</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="flex justify-end mt-4 no-print">
                        <button class="secondary-button print-btn" onclick="printTable('tableReceipts', 'ØªÙ‚Ø±ÙŠØ± Ø³Ù†Ø¯Ø§Øª Ø§Ù„Ù‚Ø¨Ø¶')">Ø·Ø¨Ø§Ø¹Ø© Ø³Ù†Ø¯Ø§Øª Ø§Ù„Ù‚Ø¨Ø¶</button>
                    </div>
                </div>

                <!-- Payments Tab -->
                <div id="payments" class="tab-content">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ’¸ Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØµØ±Ù</h2>
                    <p class="text-gray-600 mb-6">ÙˆØ«Ù‘Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø£Ùˆ Ø§Ù„Ø´ÙŠÙƒØ§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¯ÙØ¹Ù‡Ø§ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ø£Ùˆ Ù„Ø£ÙŠ ØºØ±Ø¶ Ø¢Ø®Ø±. Ù‡Ø°Ø§ ÙŠØ³Ø¬Ù„ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„Ø®Ø§Ø±Ø¬Ø© Ø¨Ø¯Ù‚Ø© ÙˆÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª.</p>
                    <form id="formPayments" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label for="paymentAmount" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input type="number" id="paymentAmount" min="0.01" step="0.01" class="form-input-field" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" />
                            <p class="error-message" id="paymentAmount-error"></p>
                        </div>
                        <div>
                            <label for="paymentCurrency" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                            <select id="paymentCurrency" class="form-input-field" required>
                                <option value="">Ø§Ø®ØªØ± Ø¹Ù…Ù„Ø©</option>
                                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                                <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                                <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                <option value="EGP">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ (EGP)</option>
                                <option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ (YER)</option>
                            </select>
                            <p class="error-message" id="paymentCurrency-error"></p>
                        </div>
                        <div class="col-span-full sm:col-span-1">
                            <label for="paymentDate" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="paymentDate" class="form-input-field" required />
                            <p class="error-message" id="paymentDate-error"></p>
                        </div>

                        <div>
                            <label for="paymentSender" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„</label>
                            <input type="text" id="paymentSender" class="form-input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„" required />
                            <p class="error-message" id="paymentSender-error"></p>
                        </div>
                        <div>
                            <label for="paymentSenderEntity" class="block text-sm font-medium text-gray-700 mb-1">Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„</label>
                            <input type="text" id="paymentSenderEntity" class="form-input-field" placeholder="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„" required />
                            <p class="error-message" id="paymentSenderEntity-error"></p>
                        </div>
                        <div>
                            <label for="paymentReceiver" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                            <input type="text" id="paymentReceiver" class="form-input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…" required />
                            <p class="error-message" id="paymentReceiver-error"></p>
                        </div>
                        <div>
                            <label for="paymentReceiverEntity" class="block text-sm font-medium text-gray-700 mb-1">Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
                            <input type="text" id="paymentReceiverEntity" class="form-input-field" placeholder="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…" required />
                            <p class="error-message" id="paymentReceiverEntity-error"></p>
                        </div>
                        <div class="col-span-full">
                            <label for="paymentNotes" class="block text-sm font-medium text-gray-700 mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <textarea id="paymentNotes" rows="3" class="form-input-field"></textarea>
                        </div>

                        <div class="col-span-full flex justify-end mt-4">
                            <button type="submit" class="primary-button">Ø­ÙØ¸ Ø§Ù„Ø³Ù†Ø¯</button>
                        </div>
                    </form>

                    <h3 class="text-xl font-semibold text-gray-800 mt-8 mb-4">Ø³Ø¬Ù„ Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØµØ±Ù</h3>
                    <div class="data-table-container">
                        <table id="tablePayments" class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù…</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„</th>
                                    <th>Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„</th>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                                    <th>Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                                    <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                    <th>Ø­Ø°Ù</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="flex justify-end mt-4 no-print">
                        <button class="secondary-button print-btn" onclick="printTable('tablePayments', 'ØªÙ‚Ø±ÙŠØ± Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØµØ±Ù')">Ø·Ø¨Ø§Ø¹Ø© Ø³Ù†Ø¯Ø§Øª Ø§Ù„ØµØ±Ù</button>
                    </div>
                </div>

                <!-- Exchange Tab -->
                <div id="exchange" class="tab-content">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ’± Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</h2>
                    <p class="text-gray-600 mb-6">Ø³Ø¬Ù„ Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø£Ø¬Ù†Ø¨ÙŠØ©. Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ù†Ø§ØªØ¬Ø© Ø¹Ù† ÙØ±ÙˆÙ‚Ø§Øª Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ù„Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©.</p>
                    <form id="formExchange" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="col-span-full">
                            <label for="exchangeType" class="block text-sm font-medium text-gray-700 mb-1">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                            <select id="exchangeType" class="form-input-field" required>
                                <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</option>
                                <option value="Ø´Ø±Ø§Ø¡">Ø´Ø±Ø§Ø¡</option>
                                <option value="Ø¨ÙŠØ¹">Ø¨ÙŠØ¹</option>
                            </select>
                            <p class="error-message" id="exchangeType-error"></p>
                        </div>

                        <div>
                            <label for="exchangeCurrency" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                            <select id="exchangeCurrency" class="form-input-field" required>
                                <option value="">Ø§Ø®ØªØ± Ø¹Ù…Ù„Ø©</option>
                                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                                <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                                <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                <option value="EGP">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ (EGP)</option>
                                <option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ (YER)</option>
                            </select>
                            <p class="error-message" id="exchangeCurrency-error"></p>
                        </div>
                        <div>
                            <label for="exchangeRate" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ø³Ø¹Ø±</label>
                            <input type="number" id="exchangeRate" min="0.0001" step="0.0001" class="form-input-field" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø±" />
                            <p class="error-message" id="exchangeRate-error"></p>
                        </div>
                        <div>
                            <label for="exchangeAmount" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input type="number" id="exchangeAmount" min="0.01" step="0.01" class="form-input-field" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" />
                            <p class="error-message" id="exchangeAmount-error"></p>
                        </div>
                        <div class="col-span-full sm:col-span-1">
                            <label for="exchangeDate" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="exchangeDate" class="form-input-field" required />
                            <p class="error-message" id="exchangeDate-error"></p>
                        </div>

                        <div class="col-span-full flex justify-end mt-4">
                            <button type="submit" class="primary-button">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
                        </div>
                    </form>

                    <h3 class="text-xl font-semibold text-gray-800 mt-8 mb-4">Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</h3>
                    <div class="data-table-container">
                        <table id="tableExchange" class="data-table">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù…</th>
                                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                                    <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø­Ø°Ù</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="flex justify-end mt-4 no-print">
                        <button class="secondary-button print-btn" onclick="printTable('tableExchange', 'ØªÙ‚Ø±ÙŠØ± Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Øª')">Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</button>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div id="reports" class="tab-content">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“Š ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
                    <p class="text-gray-600 mb-6">Ø§Ø³ØªØ®Ø±Ø¬ ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ù…ÙØµÙ„ Ù„Ø£ÙŠ Ø¹Ù…ÙŠÙ„ØŒ Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ­Ø¯ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø²Ù…Ù†ÙŠ. Ù‡Ø°Ø§ ÙŠÙˆÙØ± Ø±Ø¤ÙŠØ© ÙˆØ§Ø¶Ø­Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§ØªØŒ Ø³Ù†Ø¯Ø§Øª Ø§Ù„Ù‚Ø¨Ø¶ ÙˆØ§Ù„ØµØ±Ù.</p>

                    <form id="formReports" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="col-span-full sm:col-span-1">
                            <label for="reportClientName" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                            <input type="text" id="reportClientName" class="form-input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" />
                            <p class="error-message" id="reportClientName-error"></p>
                        </div>
                        <div class="col-span-full sm:col-span-1">
                            <label for="reportClientEntity" class="block text-sm font-medium text-gray-700 mb-1">Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" id="reportClientEntity" class="form-input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„" />
                        </div>
                        <div class="col-span-full sm:col-span-1">
                            <label for="reportFromDate" class="block text-sm font-medium text-gray-700 mb-1">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="reportFromDate" class="form-input-field" />
                        </div>
                        <div class="col-span-full sm:col-span-1">
                            <label for="reportToDate" class="block text-sm font-medium text-gray-700 mb-1">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="reportToDate" class="form-input-field" />
                        </div>
                        <div class="col-span-full flex justify-end mt-4">
                            <button type="button" id="btnGenerateStatement" class="primary-button">Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                        </div>
                    </form>

                    <div id="statementResult" class="mt-8 p-4 bg-gray-100 rounded-lg border border-gray-200 min-h-[150px] text-sm text-gray-700 shadow-sm">
                        <p class="text-center text-gray-500">Ø³ÙŠØ¸Ù‡Ø± ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ø³ØªØ®Ø±Ø§Ø¬Ù‡.</p>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settings" class="tab-content">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                    <p class="text-gray-600 mb-6">Ø§Ø¶Ø¨Ø· Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù†Ø¸Ø§Ù… Ù…Ø«Ù„ Ø§Ø³Ù… Ø´Ø±ÙƒØªÙƒ ÙˆØ§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ø¶Ù…Ø§Ù† Ù…Ø±ÙˆÙ†Ø© Ø§Ù„Ù†Ø¸Ø§Ù….</p>
                    <form id="formSettings" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="companyName" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label>
                            <input type="text" id="companyName" class="form-input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©" />
                        </div>
                        <div>
                            <label for="baseCurrency" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</label>
                            <select id="baseCurrency" class="form-input-field">
                                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                                <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                                <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                <option value="EGP">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ (EGP)</option>
                                <option value="YER">Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ (YER)</option>
                            </select>
                        </div>
                        <div class="col-span-full flex justify-end mt-4">
                            <button type="submit" class="primary-button">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Alerts/Confirmations -->
    <div id="customModal" class="modal hidden">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-lg font-bold mb-4"></h3>
            <p id="modalMessage" class="text-gray-700 mb-6"></p>
            <div class="modal-buttons">
                <button id="modalConfirmBtn" class="modal-button modal-confirm hidden">ØªØ£ÙƒÙŠØ¯</button>
                <button id="modalCancelBtn" class="modal-button modal-cancel">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script>
        // Custom Modal Functions
        let resolveModalPromise;

        function showCustomAlert(message, title = 'ØªÙ†Ø¨ÙŠÙ‡') {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalConfirmBtn').classList.add('hidden');
            document.getElementById('modalCancelBtn').textContent = 'Ø¥ØºÙ„Ø§Ù‚';
            document.getElementById('customModal').classList.remove('hidden');

            return new Promise(resolve => {
                resolveModalPromise = resolve;
                document.getElementById('modalCancelBtn').onclick = () => {
                    document.getElementById('customModal').classList.add('hidden');
                    resolve(false);
                };
            });
        }

        function showCustomConfirm(message, title = 'ØªØ£ÙƒÙŠØ¯') {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalConfirmBtn').classList.remove('hidden');
            document.getElementById('modalCancelBtn').textContent = 'Ø¥Ù„ØºØ§Ø¡';
            document.getElementById('customModal').classList.remove('hidden');

            return new Promise(resolve => {
                resolveModalPromise = resolve;
                document.getElementById('modalConfirmBtn').onclick = () => {
                    document.getElementById('customModal').classList.add('hidden');
                    resolve(true);
                };
                document.getElementById('modalCancelBtn').onclick = () => {
                    document.getElementById('customModal').classList.add('hidden');
                    resolve(false);
                };
            });
        }

        // --- Core Application Logic ---

        // Tab switching logic
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                document.getElementById(button.dataset.tab).classList.add('active');
                if (button.dataset.tab === 'dashboard') {
                    renderDashboardSummary(); // Update dashboard when active
                }
            });
        });

        // Save and load data from localStorage
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }
        function loadData(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : [];
        }

        // Set today's date as default for date inputs
        function setTodayDate(id) {
            const input = document.getElementById(id);
            if(input && !input.value) {
                input.valueAsDate = new Date();
            }
        }

        // Inline form validation handler
        function validateForm(formId, fields) {
            let isValid = true;
            fields.forEach(field => {
                const inputElement = document.getElementById(field.id);
                const errorElement = document.getElementById(`${field.id}-error`);
                if (inputElement && errorElement) {
                    let value = inputElement.value.trim();
                    let errorMessage = '';

                    if (field.required && (!value || value === '')) { // Added "" for select default value
                        errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù…Ø·Ù„ÙˆØ¨.';
                    } else if (field.type === 'number' && value && parseFloat(value) <= 0) {
                        errorMessage = 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø¨Ù„Øº Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±.';
                    } 

                    if (errorMessage) {
                        errorElement.textContent = errorMessage;
                        inputElement.classList.add('border-red-500');
                        isValid = false;
                    } else {
                        errorElement.textContent = '';
                        inputElement.classList.remove('border-red-500');
                    }
                }
            });
            return isValid;
        }

        // Delete item from data and re-render table
        async function deleteItem(key, index, renderFn) {
            const confirmed = await showCustomConfirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ', 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù');
            if (confirmed) {
                let arr = loadData(key);
                arr.splice(index, 1);
                arr = arr.map((item, i) => ({...item, Ø±Ù‚Ù…: i + 1}));
                saveData(key, arr);
                renderFn();
                renderDashboardSummary(); // Update dashboard after deletion
                showCustomAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­.');
            }
        }

        // Print table function
        function printTable(tableId, title) {
            const tableElement = document.getElementById(tableId);
            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            const companyName = settings.companyName || 'Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ±Ø§ÙØ©';
            const printDate = new Date().toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });

            const printHeader = `
                <div style="text-align: center; margin-bottom: 20px; padding-bottom: 10px;">
                    <h2 style="margin: 0; color: #333;">${companyName}</h2>
                    <h1 style="margin: 5px 0 0; color: #555; font-size: 20px;">${title}</h1>
                    <p style="margin: 5px 0 0; font-size: 12px; color: #777;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${printDate}</p>
                </div>
            `;
            
            // Clone table to manipulate without affecting original DOM
            const clonedTable = tableElement.cloneNode(true);
            clonedTable.classList.remove('responsive-table'); // Remove responsive classes for print
            clonedTable.style.width = '100%'; // Ensure table takes full width in print

            const originalContents = document.body.innerHTML;
            document.body.innerHTML = `
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${title}</title>
                    <style>
                        body {
                            font-family: 'Tahoma', sans-serif;
                            margin: 20mm; /* A4 margins */
                            padding: 0;
                            font-size: 10pt;
                            color: #000;
                        }
                        h1, h2, h3, p {
                            color: #000 !important;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 20px;
                            direction: rtl; /* Ensure RTL in print */
                        }
                        th, td {
                            border: 1px solid #ccc; /* Clearer borders for print */
                            padding: 5px 8px;
                            text-align: right;
                        }
                        th {
                            background-color: #e0e0e0 !important;
                            color: #000 !important;
                            font-weight: bold;
                        }
                        tbody tr:nth-child(even) {
                            background-color: #f5f5f5 !important;
                        }
                        /* Hide the delete button column in print */
                        .no-print-column {
                            display: none;
                        }
                    </style>
                </head>
                <body>
                    ${printHeader}
                    ${clonedTable.outerHTML}
                </body>
                </html>
            `;
            // Remove the "Ø­Ø°Ù" column for printing
            const cellsToDelete = document.querySelectorAll('th:last-child, td:last-child');
            cellsToDelete.forEach(cell => {
                cell.classList.add('no-print-column');
            });
            
            window.print();
            document.body.innerHTML = originalContents;
            window.location.reload(); // Reload to restore original state
        }

        // --- Dashboard Summary ---
        function renderDashboardSummary() {
            const currencyBalancesDiv = document.getElementById('currencyBalances');
            currencyBalancesDiv.innerHTML = '';
            
            const transfers = loadData('transfers');
            const receipts = loadData('receipts');
            const payments = loadData('payments');
            const exchanges = loadData('exchanges');

            let totalBalances = {}; // { 'USD': 1000, 'SAR': 500, ... }

            // Process Transfers
            transfers.forEach(tx => {
                const amount = parseFloat(tx.Ù…Ø¨Ù„Øº);
                const currency = tx.Ø¹Ù…Ù„Ø©;
                if (!totalBalances[currency]) totalBalances[currency] = 0;
                if (tx.Ù†ÙˆØ¹ === 'ÙˆØ§Ø±Ø¯') {
                    totalBalances[currency] += amount;
                } else if (tx.Ù†ÙˆØ¹ === 'ØµØ§Ø¯Ø±') {
                    totalBalances[currency] -= amount;
                }
            });

            // Process Receipts
            receipts.forEach(rcpt => {
                const amount = parseFloat(rcpt.Ù…Ø¨Ù„Øº);
                const currency = rcpt.Ø¹Ù…Ù„Ø©;
                if (!totalBalances[currency]) totalBalances[currency] = 0;
                totalBalances[currency] += amount;
            });

            // Process Payments
            payments.forEach(pay => {
                const amount = parseFloat(pay.Ù…Ø¨Ù„Øº);
                const currency = pay.Ø¹Ù…Ù„Ø©;
                if (!totalBalances[currency]) totalBalances[currency] = 0;
                totalBalances[currency] -= amount;
            });

            // Process Exchanges (affecting our holdings)
            exchanges.forEach(ex => {
                const amount = parseFloat(ex.Ù…Ø¨Ù„Øº);
                const currency = ex.Ø¹Ù…Ù„Ø©; 
                if (!totalBalances[currency]) totalBalances[currency] = 0;
                if (ex.Ù†ÙˆØ¹ === 'Ø´Ø±Ø§Ø¡') { // Buying a currency increases our holding of it
                    totalBalances[currency] += amount;
                } else if (ex.Ù†ÙˆØ¹ === 'Ø¨ÙŠØ¹') { // Selling a currency decreases our holding of it
                    totalBalances[currency] -= amount;
                }
            });

            if (Object.keys(totalBalances).length === 0) {
                currencyBalancesDiv.innerHTML = `
                    <div class="col-span-full bg-white p-6 rounded-lg shadow-sm border border-gray-200 text-center">
                        <p class="text-xl font-bold text-gray-700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±ØµØ¯Ø© Ù„Ø­Ø³Ø§Ø¨Ù‡Ø§ Ø¨Ø¹Ø¯.</p>
                        <p class="text-gray-500 mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰.</p>
                    </div>
                `;
            } else {
                for (const currency in totalBalances) {
                    const balance = totalBalances[currency].toFixed(2);
                    const card = document.createElement('div');
                    card.className = 'bg-white p-4 rounded-lg shadow-sm border border-gray-200 text-center flex flex-col items-center justify-center';
                    card.innerHTML = `
                        <p class="text-sm text-gray-500">${currency}</p>
                        <p class="text-2xl font-bold ${balance >= 0 ? 'text-emerald-700' : 'text-red-600'}">${balance}</p>
                    `;
                    currencyBalancesDiv.appendChild(card);
                }
            }
        }

        // --- WhatsApp Parsing Logic ---
        document.getElementById('parseWhatsappBtn').addEventListener('click', () => {
            const message = document.getElementById('whatsappMessageInput').value.trim();
            const feedbackElement = document.getElementById('parseFeedback');
            feedbackElement.textContent = ''; // Clear previous feedback

            if (!message) {
                feedbackElement.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù„ØµÙ‚ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø£ÙˆÙ„Ø§Ù‹.';
                feedbackElement.style.color = 'red';
                return;
            }

            let parsedData = {
                type: '',
                amount: null,
                currency: '',
                sender: '',
                senderEntity: '',
                receiver: '',
                receiverEntity: ''
            };
            let allParsed = true;

            // Regex for amount and currency
            const amountCurrencyMatch = message.match(/(\d+(?:[.,]\d+)?)\s*(Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ|Ø¯ÙˆÙ„Ø§Ø±|ÙŠÙˆØ±Ùˆ|Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ|Ø±ÙŠØ§Ù„|Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ|Ø¯Ø±Ù‡Ù…|Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ|Ø¬Ù†ÙŠÙ‡|Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ|YER|USD|EUR|SAR|AED|EGP)\b/i);
            if (amountCurrencyMatch) {
                parsedData.amount = parseFloat(amountCurrencyMatch[1].replace(',', '.')); // Handle comma as decimal
                const currencyText = amountCurrencyMatch[2].toLowerCase();
                if (currencyText.includes('Ø¯ÙˆÙ„Ø§Ø±') || currencyText.includes('usd')) parsedData.currency = 'USD';
                else if (currencyText.includes('ÙŠÙˆØ±Ùˆ') || currencyText.includes('eur')) parsedData.currency = 'EUR';
                else if (currencyText.includes('Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ') || currencyText.includes('sar')) parsedData.currency = 'SAR';
                else if (currencyText.includes('Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ') || currencyText.includes('aed')) parsedData.currency = 'AED';
                else if (currencyText.includes('Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ') || currencyText.includes('egp')) parsedData.currency = 'EGP';
                else if (currencyText.includes('Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ') || currencyText.includes('yer') || currencyText === 'Ø±ÙŠØ§Ù„') parsedData.currency = 'YER';
                else allParsed = false; // Could not map currency
            } else {
                allParsed = false;
            }

            // Regex for transfer type (ØµØ§Ø¯Ø±/ÙˆØ§Ø±Ø¯)
            if (message.includes('ØµØ§Ø¯Ø±') || message.includes('Ø¥Ø±Ø³Ø§Ù„') || message.includes('Ù„Ù€') || message.includes('Ø§Ù„Ù‰')) {
                parsedData.type = 'ØµØ§Ø¯Ø±';
            } else if (message.includes('ÙˆØ§Ø±Ø¯Ø©') || message.includes('Ù…Ù†') || message.includes('Ø§Ø³ØªÙ„Ø§Ù…')) {
                parsedData.type = 'ÙˆØ§Ø±Ø¯';
            } else {
                parsedData.type = 'ØµØ§Ø¯Ø±'; // Default if not clear
            }

            // Extract sender and receiver names/entities
            const arabicNamesRegex = '[\u0621-\u064A\u0660-\u0669\\s\\w.-]+'; // Arabic letters, numbers, spaces, some symbols
            const pattern1 = new RegExp(`Ù…Ù†\\s*(${arabicNamesRegex})(?:\\s*\\(([^\)]+?)\\))?\\s*Ø¥Ù„Ù‰\\s*(${arabicNamesRegex})(?:\\s*\\(([^\)]+?)\\))?`, 'i');
            const pattern2 = new RegExp(`Ø¥Ù„Ù‰\\s*(${arabicNamesRegex})(?:\\s*\\(([^\)]+?)\\))?\\s*Ù…Ù†\\s*(${arabicNamesRegex})(?:\\s*\\(([^\)]+?)\\))?`, 'i');

            let senderReceiverMatch = message.match(pattern1);
            if (senderReceiverMatch) {
                parsedData.sender = senderReceiverMatch[1] ? senderReceiverMatch[1].trim() : '';
                parsedData.senderEntity = senderReceiverMatch[2] ? senderReceiverMatch[2].trim() : 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
                parsedData.receiver = senderReceiverMatch[3] ? senderReceiverMatch[3].trim() : '';
                parsedData.receiverEntity = senderReceiverMatch[4] ? senderReceiverMatch[4].trim() : 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
            } else {
                senderReceiverMatch = message.match(pattern2);
                if (senderReceiverMatch) {
                    parsedData.receiver = senderReceiverMatch[1] ? senderReceiverMatch[1].trim() : '';
                    parsedData.receiverEntity = senderReceiverMatch[2] ? senderReceiverMatch[2].trim() : 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
                    parsedData.sender = senderReceiverMatch[3] ? senderReceiverMatch[3].trim() : '';
                    parsedData.senderEntity = senderReceiverMatch[4] ? senderReceiverMatch[4].trim() : 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
                } else {
                    // Fallback for simpler patterns like "Ø§Ø±Ø³Ù„ X Ù„Ù€ Y Ù…Ù† Z" or "Ù‚Ø¨Ø¶ X Ù…Ù† Y Ù„Ù€ Z"
                    const simpleSenderMatch = message.match(/(?:Ù…Ù†|Ø¨ÙˆØ§Ø³Ø·Ø©|Ø¹Ù† Ø·Ø±ÙŠÙ‚)\s+([^.\n]+?)(?:\s*\(([^)]+)\))?/i);
                    if(simpleSenderMatch) {
                        parsedData.sender = simpleSenderMatch[1] ? simpleSenderMatch[1].trim() : '';
                        parsedData.senderEntity = simpleSenderMatch[2] ? simpleSenderMatch[2].trim() : 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
                    }
                    
                    const simpleReceiverMatch = message.match(/(?:Ø¥Ù„Ù‰|Ù„Ù€)\s+([^.\n]+?)(?:\s*\(([^)]+)\))?/i);
                    if(simpleReceiverMatch) {
                        parsedData.receiver = simpleReceiverMatch[1] ? simpleReceiverMatch[1].trim() : '';
                        parsedData.receiverEntity = simpleReceiverMatch[2] ? simpleReceiverMatch[2].trim() : 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
                    }
                    
                    if (!parsedData.sender || !parsedData.receiver) allParsed = false; // Mark as not fully parsed if crucial parts missing
                    parsedData.senderEntity = parsedData.senderEntity || 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
                    parsedData.receiverEntity = parsedData.receiverEntity || 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
                }
            }


            // Pre-fill the form
            document.getElementById('transferType').value = parsedData.type || 'ØµØ§Ø¯Ø±'; // Default if not found
            document.getElementById('transferAmount').value = parsedData.amount || '';
            document.getElementById('transferCurrency').value = parsedData.currency || 'USD'; // Default if not found
            document.getElementById('transferSender').value = parsedData.sender || '';
            document.getElementById('transferSenderEntity').value = parsedData.senderEntity || '';
            document.getElementById('transferReceiver').value = parsedData.receiver || '';
            document.getElementById('transferReceiverEntity').value = parsedData.receiverEntity || '';
            setTodayDate('transferDate');

            if (allParsed && parsedData.amount && parsedData.currency && parsedData.sender && parsedData.receiver) {
                feedbackElement.textContent = 'âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆÙ…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ­ÙØ¸ Ø§Ù„Ø­ÙˆØ§Ù„Ø©.';
                feedbackElement.style.color = 'green';
            } else {
                feedbackElement.textContent = 'âš ï¸ ØªÙ… Ù…Ù„Ø¡ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙØ§Ø±ØºØ© Ø£Ùˆ ØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­Ø© ÙˆØ¥ÙƒÙ…Ø§Ù„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹. (Ø£Ù…Ø«Ù„Ø©: "Ø§Ù„Ù…Ø¨Ù„Øº", "Ø§Ù„Ø¹Ù…Ù„Ø©", "Ø§Ù„Ù…Ø±Ø³Ù„", "Ø§Ù„Ù…Ø³ØªÙ„Ù…" Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡Ø§ Ø¨ÙˆØ¶ÙˆØ­).';
                feedbackElement.style.color = 'orange';
            }
        });

        // Transfers form submission
        document.getElementById('formTransfers').addEventListener('submit', async e => {
            e.preventDefault();
            const formFields = [
                { id: 'transferType', required: true, type: 'select' },
                { id: 'transferAmount', required: true, type: 'number' },
                { id: 'transferCurrency', required: true, type: 'select' },
                { id: 'transferDate', required: true, type: 'date' },
                { id: 'transferSender', required: true, type: 'text' },
                { id: 'transferSenderEntity', required: true, type: 'text' },
                { id: 'transferReceiver', required: true, type: 'text' },
                { id: 'transferReceiverEntity', required: true, type: 'text' }
            ];

            if (!validateForm('formTransfers', formFields)) {
                await showCustomAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.');
                return;
            }

            const type = document.getElementById('transferType').value;
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const currency = document.getElementById('transferCurrency').value;
            const date = document.getElementById('transferDate').value;
            const sender = document.getElementById('transferSender').value.trim();
            const senderEntity = document.getElementById('transferSenderEntity').value.trim();
            const receiver = document.getElementById('transferReceiver').value.trim();
            const receiverEntity = document.getElementById('transferReceiverEntity').value.trim();

            let transfers = loadData('transfers');
            transfers.push({
                Ø±Ù‚Ù…: transfers.length + 1,
                Ù†ÙˆØ¹: type,
                Ù…Ø¨Ù„Øº: amount.toFixed(2),
                Ø¹Ù…Ù„Ø©: currency,
                ØªØ§Ø±ÙŠØ®: date,
                Ù…Ø±Ø³Ù„: sender,
                Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„: senderEntity,
                Ù…Ø³ØªÙ„Ù…: receiver,
                Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…: receiverEntity
            });
            saveData('transfers', transfers);
            renderTransfersTable();
            e.target.reset();
            setTodayDate('transferDate');
            document.getElementById('whatsappMessageInput').value = '';
            document.getElementById('parseFeedback').textContent = '';
            renderDashboardSummary(); // Update dashboard after saving
            await showCustomAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
        });

        // Render Transfers table
        function renderTransfersTable() {
            const data = loadData('transfers');
            const tbody = document.querySelector('#tableTransfers tbody');
            tbody.innerHTML = '';
            data.forEach((item, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="Ø±Ù‚Ù…">${item.Ø±Ù‚Ù…}</td>
                    <td data-label="Ù†ÙˆØ¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„">${item.Ù†ÙˆØ¹}</td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${item.Ù…Ø¨Ù„Øº}</td>
                    <td data-label="Ø§Ù„Ø¹Ù…Ù„Ø©">${item.Ø¹Ù…Ù„Ø©}</td>
                    <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${item.ØªØ§Ø±ÙŠØ®}</td>
                    <td data-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„">${item.Ù…Ø±Ø³Ù„}</td>
                    <td data-label="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„">${item.Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„}</td>
                    <td data-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…">${item.Ù…Ø³ØªÙ„Ù…}</td>
                    <td data-label="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…">${item.Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…}</td>
                    <td data-label="Ø­Ø°Ù"><button class="action-button" onclick="deleteItem('transfers', ${i}, renderTransfersTable)">Ø­Ø°Ù</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Receipts form submission
        document.getElementById('formReceipts').addEventListener('submit', async e => {
            e.preventDefault();
            const formFields = [
                { id: 'receiptAmount', required: true, type: 'number' },
                { id: 'receiptCurrency', required: true, type: 'select' },
                { id: 'receiptDate', required: true, type: 'date' },
                { id: 'receiptSender', required: true, type: 'text' },
                { id: 'receiptSenderEntity', required: true, type: 'text' },
                { id: 'receiptReceiver', required: true, type: 'text' },
                { id: 'receiptReceiverEntity', required: true, type: 'text' }
            ];

            if (!validateForm('formReceipts', formFields)) {
                await showCustomAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.');
                return;
            }

            const amount = parseFloat(document.getElementById('receiptAmount').value);
            const currency = document.getElementById('receiptCurrency').value;
            const date = document.getElementById('receiptDate').value;
            const sender = document.getElementById('receiptSender').value.trim();
            const senderEntity = document.getElementById('receiptSenderEntity').value.trim();
            const receiver = document.getElementById('receiptReceiver').value.trim();
            const receiverEntity = document.getElementById('receiptReceiverEntity').value.trim();
            const notes = document.getElementById('receiptNotes').value.trim();

            let receipts = loadData('receipts');
            receipts.push({
                Ø±Ù‚Ù…: receipts.length + 1,
                Ù…Ø¨Ù„Øº: amount.toFixed(2),
                Ø¹Ù…Ù„Ø©: currency,
                ØªØ§Ø±ÙŠØ®: date,
                Ù…Ø±Ø³Ù„: sender,
                Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„: senderEntity,
                Ù…Ø³ØªÙ„Ù…: receiver,
                Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…: receiverEntity,
                Ù…Ù„Ø§Ø­Ø¸Ø§Øª: notes
            });
            saveData('receipts', receipts);
            renderReceiptsTable();
            e.target.reset();
            setTodayDate('receiptDate');
            renderDashboardSummary(); // Update dashboard after saving
            await showCustomAlert('ØªÙ… Ø­ÙØ¸ Ø³Ù†Ø¯ Ø§Ù„Ù‚Ø¨Ø¶ Ø¨Ù†Ø¬Ø§Ø­!');
        });

        // Render Receipts table
        function renderReceiptsTable() {
            const data = loadData('receipts');
            const tbody = document.querySelector('#tableReceipts tbody');
            tbody.innerHTML = '';
            data.forEach((item, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="Ø±Ù‚Ù…">${item.Ø±Ù‚Ù…}</td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${item.Ù…Ø¨Ù„Øº}</td>
                    <td data-label="Ø§Ù„Ø¹Ù…Ù„Ø©">${item.Ø¹Ù…Ù„Ø©}</td>
                    <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${item.ØªØ§Ø±ÙŠØ®}</td>
                    <td data-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„">${item.Ù…Ø±Ø³Ù„}</td>
                    <td data-label="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„">${item.Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„}</td>
                    <td data-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…">${item.Ù…Ø³ØªÙ„Ù…}</td>
                    <td data-label="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…">${item.Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…}</td>
                    <td data-label="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">${item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª}</td>
                    <td data-label="Ø­Ø°Ù"><button class="action-button" onclick="deleteItem('receipts', ${i}, renderReceiptsTable)">Ø­Ø°Ù</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Payments form submission
        document.getElementById('formPayments').addEventListener('submit', async e => {
            e.preventDefault();
            const formFields = [
                { id: 'paymentAmount', required: true, type: 'number' },
                { id: 'paymentCurrency', required: true, type: 'select' },
                { id: 'paymentDate', required: true, type: 'date' },
                { id: 'paymentSender', required: true, type: 'text' },
                { id: 'paymentSenderEntity', required: true, type: 'text' },
                { id: 'paymentReceiver', required: true, type: 'text' },
                { id: 'paymentReceiverEntity', required: true, type: 'text' }
            ];

            if (!validateForm('formPayments', formFields)) {
                await showCustomAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.');
                return;
            }

            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const currency = document.getElementById('paymentCurrency').value;
            const date = document.getElementById('paymentDate').value;
            const sender = document.getElementById('paymentSender').value.trim();
            const senderEntity = document.getElementById('paymentSenderEntity').value.trim();
            const receiver = document.getElementById('paymentReceiver').value.trim();
            const receiverEntity = document.getElementById('paymentReceiverEntity').value.trim();
            const notes = document.getElementById('paymentNotes').value.trim();

            let payments = loadData('payments');
            payments.push({
                Ø±Ù‚Ù…: payments.length + 1,
                Ù…Ø¨Ù„Øº: amount.toFixed(2),
                Ø¹Ù…Ù„Ø©: currency,
                ØªØ§Ø±ÙŠØ®: date,
                Ù…Ø±Ø³Ù„: sender,
                Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„: senderEntity,
                Ù…Ø³ØªÙ„Ù…: receiver,
                Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…: receiverEntity,
                Ù…Ù„Ø§Ø­Ø¸Ø§Øª: notes
            });
            saveData('payments', payments);
            renderPaymentsTable();
            e.target.reset();
            setTodayDate('paymentDate');
            renderDashboardSummary(); // Update dashboard after saving
            await showCustomAlert('ØªÙ… Ø­ÙØ¸ Ø³Ù†Ø¯ Ø§Ù„ØµØ±Ù Ø¨Ù†Ø¬Ø§Ø­!');
        });

        // Render Payments table
        function renderPaymentsTable() {
            const data = loadData('payments');
            const tbody = document.querySelector('#tablePayments tbody');
            tbody.innerHTML = '';
            data.forEach((item, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="Ø±Ù‚Ù…">${item.Ø±Ù‚Ù…}</td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${item.Ù…Ø¨Ù„Øº}</td>
                    <td data-label="Ø§Ù„Ø¹Ù…Ù„Ø©">${item.Ø¹Ù…Ù„Ø©}</td>
                    <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${item.ØªØ§Ø±ÙŠØ®}</td>
                    <td data-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„">${item.Ù…Ø±Ø³Ù„}</td>
                    <td data-label="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø±Ø³Ù„">${item.Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„}</td>
                    <td data-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…">${item.Ù…Ø³ØªÙ„Ù…}</td>
                    <td data-label="Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙ„Ù…">${item.Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…}</td>
                    <td data-label="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">${item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª}</td>
                    <td data-label="Ø­Ø°Ù"><button class="action-button" onclick="deleteItem('payments', ${i}, renderPaymentsTable)">Ø­Ø°Ù</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Exchange form submission
        document.getElementById('formExchange').addEventListener('submit', async e => {
            e.preventDefault();
            const formFields = [
                { id: 'exchangeType', required: true, type: 'select' },
                { id: 'exchangeCurrency', required: true, type: 'select' },
                { id: 'exchangeRate', required: true, type: 'number' },
                { id: 'exchangeAmount', required: true, type: 'number' },
                { id: 'exchangeDate', required: true, type: 'date' }
            ];

            if (!validateForm('formExchange', formFields)) {
                await showCustomAlert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.');
                return;
            }

            const type = document.getElementById('exchangeType').value;
            const currency = document.getElementById('exchangeCurrency').value;
            const rate = parseFloat(document.getElementById('exchangeRate').value);
            const amount = parseFloat(document.getElementById('exchangeAmount').value);
            const date = document.getElementById('exchangeDate').value;

            let exchanges = loadData('exchanges');
            exchanges.push({
                Ø±Ù‚Ù…: exchanges.length + 1,
                Ù†ÙˆØ¹: type,
                Ø¹Ù…Ù„Ø©: currency,
                Ø³Ø¹Ø±: rate.toFixed(4),
                Ù…Ø¨Ù„Øº: amount.toFixed(2),
                ØªØ§Ø±ÙŠØ®: date
            });
            saveData('exchanges', exchanges);
            renderExchangeTable();
            e.target.reset();
            setTodayDate('exchangeDate');
            renderDashboardSummary(); // Update dashboard after saving
            await showCustomAlert('ØªÙ… Ø­ÙØ¸ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØµØ±Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!');
        });

        // Render Exchange table
        function renderExchangeTable() {
            const data = loadData('exchanges');
            const tbody = document.querySelector('#tableExchange tbody');
            tbody.innerHTML = '';
            data.forEach((item, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="Ø±Ù‚Ù…">${item.Ø±Ù‚Ù…}</td>
                    <td data-label="Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">${item.Ù†ÙˆØ¹}</td>
                    <td data-label="Ø§Ù„Ø¹Ù…Ù„Ø©">${item.Ø¹Ù…Ù„Ø©}</td>
                    <td data-label="Ø§Ù„Ø³Ø¹Ø±">${item.Ø³Ø¹Ø±}</td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${item.Ù…Ø¨Ù„Øº}</td>
                    <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${item.ØªØ§Ø±ÙŠØ®}</td>
                    <td data-label="Ø­Ø°Ù"><button class="action-button" onclick="deleteItem('exchanges', ${i}, renderExchangeTable)">Ø­Ø°Ù</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Generate Report (Statement)
        document.getElementById('btnGenerateStatement').addEventListener('click', async () => {
            const clientName = document.getElementById('reportClientName').value.trim();
            const clientEntity = document.getElementById('reportClientEntity').value.trim();
            const fromDate = document.getElementById('reportFromDate').value;
            const toDate = document.getElementById('reportToDate').value;
            const resultDiv = document.getElementById('statementResult');

            if (!clientName) {
                await showCustomAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨.');
                return;
            }

            const transfers = loadData('transfers');
            const receipts = loadData('receipts');
            const payments = loadData('payments');
            const exchanges = loadData('exchanges');

            function isInDateRange(dateStr) {
                if (!fromDate && !toDate) return true;
                const d = new Date(dateStr);
                const from = fromDate ? new Date(fromDate) : null;
                const to = toDate ? new Date(toDate) : null;

                if (from && d < from) return false;
                if (to && d > to) return false;
                return true;
            }

            function filterByClientAndEntity(arr, senderKey, senderEntityKey, receiverKey, receiverEntityKey) {
                return arr.filter(item => {
                    const clientNameMatch = (item[senderKey] && item[senderKey].includes(clientName)) || (item[receiverKey] && item[receiverKey].includes(clientName));
                    const clientEntityMatch = clientEntity ? ((item[senderEntityKey] && item[senderEntityKey].includes(clientEntity)) || (item[receiverEntityKey] && item[receiverEntityKey].includes(clientEntity))) : true;
                    return clientNameMatch && clientEntityMatch && isInDateRange(item.ØªØ§Ø±ÙŠØ®);
                });
            }

            let allRecords = [];

            allRecords = allRecords.concat(
                filterByClientAndEntity(transfers, 'Ù…Ø±Ø³Ù„', 'Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„', 'Ù…Ø³ØªÙ„Ù…', 'Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…').map(item => ({
                    Ù†ÙˆØ¹: 'ØªØ­ÙˆÙŠÙ„',
                    ØªÙØ§ØµÙŠÙ„: `${item.Ù†ÙˆØ¹} - Ù…Ù† ${item.Ù…Ø±Ø³Ù„} (${item.Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„}) Ø¥Ù„Ù‰ ${item.Ù…Ø³ØªÙ„Ù…} (${item.Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…})`,
                    Ù…Ø¨Ù„Øº: parseFloat(item.Ù…Ø¨Ù„Øº),
                    Ø¹Ù…Ù„Ø©: item.Ø¹Ù…Ù„Ø©,
                    ØªØ§Ø±ÙŠØ®: item.ØªØ§Ø±ÙŠØ®
                }))
            );

            allRecords = allRecords.concat(
                filterByClientAndEntity(receipts, 'Ù…Ø±Ø³Ù„', 'Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„', 'Ù…Ø³ØªÙ„Ù…', 'Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…').map(item => ({
                    Ù†ÙˆØ¹: 'Ø³Ù†Ø¯ Ù‚Ø¨Ø¶',
                    ØªÙØ§ØµÙŠÙ„: `Ù‚Ø¨Ø¶ Ù…Ù†: ${item.Ù…Ø±Ø³Ù„} (${item.Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„}) Ø¥Ù„Ù‰: ${item.Ù…Ø³ØªÙ„Ù…} (${item.Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…}) - ${item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''}`,
                    Ù…Ø¨Ù„Øº: parseFloat(item.Ù…Ø¨Ù„Øº),
                    Ø¹Ù…Ù„Ø©: item.Ø¹Ù…Ù„Ø©,
                    ØªØ§Ø±ÙŠØ®: item.ØªØ§Ø±ÙŠØ®
                }))
            );

            allRecords = allRecords.concat(
                filterByClientAndEntity(payments, 'Ù…Ø±Ø³Ù„', 'Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„', 'Ù…Ø³ØªÙ„Ù…', 'Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…').map(item => ({
                    Ù†ÙˆØ¹: 'Ø³Ù†Ø¯ ØµØ±Ù',
                    ØªÙØ§ØµÙŠÙ„: `ØµØ±Ù Ù„Ù€: ${item.Ù…Ø³ØªÙ„Ù…} (${item.Ø¬Ù‡Ø©_Ù…Ø³ØªÙ„Ù…}) Ù…Ù†: ${item.Ù…Ø±Ø³Ù„} (${item.Ø¬Ù‡Ø©_Ù…Ø±Ø³Ù„}) - ${item.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || ''}`,
                    Ù…Ø¨Ù„Øº: parseFloat(item.Ù…Ø¨Ù„Øº),
                    Ø¹Ù…Ù„Ø©: item.Ø¹Ù…Ù„Ø©,
                    ØªØ§Ø±ÙŠØ®: item.ØªØ§Ø±ÙŠØ®
                }))
            );

            const relatedExchanges = exchanges.filter(item => {
                return isInDateRange(item.ØªØ§Ø±ÙŠØ®);
            }).map(item => ({
                Ù†ÙˆØ¹: 'Ø¨ÙŠØ¹/Ø´Ø±Ø§Ø¡ Ø¹Ù…Ù„Ø©',
                ØªÙØ§ØµÙŠÙ„: `${item.Ù†ÙˆØ¹} ${item.Ù…Ø¨Ù„Øº} ${item.Ø¹Ù…Ù„Ø©} Ø¨Ø³Ø¹Ø± ${item.Ø³Ø¹Ø±}`,
                 Ù…Ø¨Ù„Øº: parseFloat(item.Ù…Ø¨Ù„Øº),
                 Ø¹Ù…Ù„Ø©: item.Ø¹Ù…Ù„Ø©,
                ØªØ§Ø±ÙŠØ®: item.ØªØ§Ø±ÙŠØ®
            }));
            allRecords = allRecords.concat(relatedExchanges);


            if (allRecords.length === 0) {
                resultDiv.innerHTML = '<p class="text-center text-red-600"><b>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø­Ø¯Ø¯.</b></p>';
                return;
            }

            allRecords.sort((a, b) => new Date(a.ØªØ§Ø±ÙŠØ®) - new Date(b.ØªØ§Ø±ÙŠØ®));

            let balances = {};
            allRecords.forEach(rec => {
                if (!balances[rec.Ø¹Ù…Ù„Ø©]) balances[rec.Ø¹Ù…Ù„Ø©] = 0;
                if (rec.Ù†ÙˆØ¹ === 'Ø³Ù†Ø¯ Ù‚Ø¨Ø¶' || (rec.Ù†ÙˆØ¹ === 'ØªØ­ÙˆÙŠÙ„' && rec.ØªÙØ§ØµÙŠÙ„.includes('ÙˆØ§Ø±Ø¯ - Ù…Ù†'))) {
                    balances[rec.Ø¹Ù…Ù„Ø©] += rec.Ù…Ø¨Ù„Øº;
                } else if (rec.Ù†ÙˆØ¹ === 'Ø³Ù†Ø¯ ØµØ±Ù' || (rec.Ù†ÙˆØ¹ === 'ØªØ­ÙˆÙŠÙ„' && rec.ØªÙØ§ØµÙŠÙ„.includes('ØµØ§Ø¯Ø± - Ù…Ù†'))) {
                    balances[rec.Ø¹Ù…Ù„Ø©] -= rec.Ù…Ø¨Ù„Øº;
                }
            });

            let html = `
                <h3 class="text-xl font-bold text-gray-800 mb-4">ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù€: ${clientName} ${clientEntity ? `(${clientEntity})` : ''}</h3>
                <div class="data-table-container mb-6">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ©</th>
                                <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            allRecords.forEach(rec => {
                html += `
                    <tr>
                        <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®">${rec.ØªØ§Ø±ÙŠØ®}</td>
                        <td data-label="Ù†ÙˆØ¹ Ø§Ù„Ø­Ø±ÙƒØ©">${rec.Ù†ÙˆØ¹}</td>
                        <td data-label="Ø§Ù„ØªÙØ§ØµÙŠÙ„">${rec.ØªÙØ§ØµÙŠÙ„}</td>
                        <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${rec.Ù…Ø¨Ù„Øº.toFixed(2)}</td>
                        <td data-label="Ø§Ù„Ø¹Ù…Ù„Ø©">${rec.Ø¹Ù…Ù„Ø©}</td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            html += '<h3 class="text-xl font-bold text-gray-800 mt-6 mb-3">Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø¹Ù…ÙŠÙ„:</h3>';
            html += '<ul class="list-disc list-inside bg-white p-4 rounded-lg border border-gray-200 shadow-sm">';
            let hasBalance = false;
            for (const [currency, bal] of Object.entries(balances)) {
                html += `<li class="mb-1 text-gray-700">${currency}: <span class="font-bold text-teal-700">${bal.toFixed(2)}</span></li>`;
                hasBalance = true;
            }
            if (!hasBalance) {
                 html += `<li class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±ØµØ¯Ø© Ù…Ø­Ø¯Ø¯Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ØªØ£Ø«Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµØ±Ø§ÙØ©).</li>`;
            }
            html += '</ul>';

            resultDiv.innerHTML = html;
        });

        // Settings form submission
        document.getElementById('formSettings').addEventListener('submit', async e => {
            e.preventDefault();
            const companyName = document.getElementById('companyName').value.trim();
            const baseCurrency = document.getElementById('baseCurrency').value;
            const settings = { companyName, baseCurrency };
            localStorage.setItem('settings', JSON.stringify(settings));
            await showCustomAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        });

        // Load settings
        function loadSettings() {
            const settings = localStorage.getItem('settings');
            if (settings) {
                const obj = JSON.parse(settings);
                if (obj.companyName) document.getElementById('companyName').value = obj.companyName;
                if (obj.baseCurrency) document.getElementById('baseCurrency').value = obj.baseCurrency;
            }
        }

        // Initial load and render
        window.addEventListener('load', () => {
            setTodayDate('transferDate');
            setTodayDate('receiptDate');
            setTodayDate('paymentDate');
            setTodayDate('exchangeDate');
            
            // Render all tables on load
            renderTransfersTable();
            renderReceiptsTable();
            renderPaymentsTable();
            renderExchangeTable();
            
            loadSettings();
            renderDashboardSummary(); // Initial dashboard render
        });
    </script>
</body>
</html>
